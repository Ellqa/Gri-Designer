<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gri-Designer</title>
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Design Tokens - Âü∫‰∫é Figma ËÆæËÆ°ËßÑËåÉ */
        :root {
            /* Typography - Font Sizes (Figma pt ‚Üí Web px, ËßÜËßâÊ†°ÂáÜ) */
            --font-size-section-title: 16px;  /* Figma 20pt ‚Üí 22px */
            --font-size-label: 14px;          /* Figma 16pt ‚Üí 17px */
            
            /* Typography - Line Heights */
            --line-height-title: 1.3;
            --line-height-body: 1.5;
            
            /* Typography - Font Weights */
            --font-weight-medium: 500;        /* Urbanist Medium */
            --font-weight-semibold: 600;      /* Urbanist SemiBold */
            
            /* Spacing */
            --spacing-section: 36px;          /* Figma 34pt ‚Üí 36px (Âå∫ÂùóÈó¥Ë∑ù) */
            --gutter: 14px;                   /* Canvas Âíå Control Panel ‰πãÈó¥ÁöÑÈó¥Èöô */
            
            /* Control Heights */
            --control-height: 28px;           /* Figma 24pt ‚Üí 28px (ËæìÂÖ•Ê°ÜÈ´òÂ∫¶) */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Urbanist', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            transition: background-color 0.3s ease;
        }

        /* Dark Mode Ê†∑Âºè */
        body.dark-mode {
            background: #1a1a1a;
        }

        body.dark-mode .container {
            background: #2a2a2a;
        }

        body.dark-mode .title {
            color: #ffffff;
        }

        body.dark-mode .canvas-area {
            background: #333333;
        }

        body.dark-mode .control-panel {
            background: #2a2a2a;
        }

        body.dark-mode .section-title {
            color: #e0e0e0;
        }

        body.dark-mode .label {
            color: #b0b0b0;
        }

        body.dark-mode .input {
            background: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .input:focus {
            border-color: #5a9fd4;
        }

        body.dark-mode .input[readonly] {
            background-color: #333;
        }

        body.dark-mode .unit {
            color: #888;
        }

        body.dark-mode .zoom-btn,
        body.dark-mode .zoom-display {
            background: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .zoom-btn:hover {
            background: #444;
            border-color: #666;
        }

        body.dark-mode .canvas {
            background: #ffffff;
        }

        body.dark-mode .control-panel::-webkit-scrollbar-track {
            background: #2a2a2a;
        }

        body.dark-mode .control-panel::-webkit-scrollbar-thumb {
            background: #555;
        }

        body.dark-mode .control-panel::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        .container {
            width: 100%;
            min-height: calc(100vh + 360px);
            position: relative;
        }

        /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 4px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark-mode .theme-toggle {
            background: #3a3a3a;
            border-color: #555;
        }

        .theme-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: background-color 0.2s;
            position: relative;
        }

        .theme-option:hover {
            background: #f0f0f0;
        }

        body.dark-mode .theme-option:hover {
            background: #444;
        }

        .theme-option.active {
            background: #007bff;
        }

        body.dark-mode .theme-option.active {
            background: #5a9fd4;
        }

        .theme-option.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
        }

        /* È°µÈù¢ËæπË∑ù */
        .page-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Ê†áÈ¢òÂå∫Âüü */
        .header {
            height: calc(360px + 30pt + 30pt);
            display: flex;
            align-items: flex-end;
            margin: 0;
            padding-left: 30px;
            padding-bottom: calc(30px + 30pt);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30pt;
            background: white;
            border-top: 0.5pt solid rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 0;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark-mode .header::before {
            background: #2a2a2a;
            border-top-color: rgba(255,255,255,0.3);
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.5) 0.5pt, transparent 0.5pt),
                linear-gradient(to bottom, rgba(0,0,0,0.5) 0.5pt, transparent 0.5pt);
            background-size: 30pt 30pt;
            background-position: 0 0;
            pointer-events: none;
            z-index: -1;
        }

        .logo {
            width: 500pt;
            height: auto;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .title-line1 {
            display: block;
        }

        .title-line2 {
            display: block;
            text-indent: 40px;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            display: flex;
            gap: var(--gutter);
            height: 100vh;
            margin: 0;
            padding: 15pt 20px 15pt 20px;
            background: white;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            position: sticky;
            top: 0;
        }

        body.dark-mode .main-content {
            background: #2a2a2a;
        }

        /* Â∑¶‰æßÁîªÂ∏ÉÂå∫Âüü */
        .canvas-area {
            flex: 5;
            background: #e5e5e5;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            transition: background-color 0.3s ease;
            min-height: 0;
        }

        /* Áº©ÊîæÊéßÂà∂ÊåâÈíÆ */
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            font-weight: 300;
            color: #333;
            transition: all 0.2s, background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
            user-select: none;
        }

        .zoom-btn:hover {
            background: #f8f8f8;
            border-color: #999;
        }

        .zoom-btn:active {
            background: #e8e8e8;
            transform: scale(0.95);
        }

        .zoom-display {
            width: 60px;
            height: 36px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
            text-align: center;
            padding: 0 4px;
            font-family: 'Urbanist', sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .zoom-display:focus {
            outline: none;
            border-color: #007bff;
        }

        .canvas-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-origin: center;
        }

        .canvas-container.animating {
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .canvas {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }

        .canvas-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        body.dark-mode .canvas-grid {
            background-image: 
                linear-gradient(rgba(0,0,0,0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.2) 1px, transparent 1px);
        }

        /* Âè≥‰æßÊéßÂà∂Èù¢Êùø */
        .control-panel {
            flex: 2;
            overflow-y: auto;
        }

        .section {
            margin-bottom: var(--spacing-section);
        }

        .section-title {
            font-size: var(--font-size-section-title);
            font-weight: var(--font-weight-medium);
            line-height: var(--line-height-title);
            color: #000000;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: color 0.3s ease;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-body);
            color: #666;
            min-width: 60px;
            transition: color 0.3s ease;
        }

        .input {
            flex: 1;
            height: var(--control-height);
            padding: 0 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            line-height: var(--line-height-body);
            font-family: 'Urbanist', sans-serif;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .input:focus {
            outline: none;
            border-color: #007bff;
        }

        .input[readonly] {
            background-color: #f5f5f5;
            cursor: default;
        }

        .unit {
            font-size: 12px;
            color: #999;
            min-width: 30px;
        }

        /* ÊªëÊùÜÊ†∑Âºè */
        .slider {
            flex: 1;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .slider:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider:disabled::-webkit-slider-thumb {
            cursor: not-allowed;
            background: #999;
        }

        .slider:disabled::-moz-range-thumb {
            cursor: not-allowed;
            background: #999;
        }

        /* Margin ÊéßÂà∂Ê†∑Âºè */
        .margin-grid {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .margin-column {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .margin-controls-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .margin-control {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .margin-control .label {
            font-size: var(--font-size-label);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-body);
            color: #666;
            transition: color 0.3s ease;
        }

        body.dark-mode .margin-control .label {
            color: #b0b0b0;
        }

        .stepper {
            display: flex;
            align-items: stretch;
            height: var(--control-height);
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
            transition: border-color 0.3s ease;
            max-width: 160px;
        }

        .stepper-btn {
            flex: 0 0 var(--control-height);
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 300;
            color: #333;
            transition: all 0.2s;
            user-select: none;
        }

        .stepper-btn:first-child {
            border-right: 1px solid #ddd;
        }

        .stepper-btn:last-child {
            border-left: 1px solid #ddd;
        }

        .stepper-btn:hover {
            background: #f8f8f8;
        }

        .stepper-btn:active {
            background: #e8e8e8;
            transform: scale(0.95);
        }

        .stepper-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        body.dark-mode .stepper {
            border-color: #555;
        }

        body.dark-mode .stepper-btn {
            background: #3a3a3a;
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-mode .stepper-btn:hover {
            background: #444;
        }

        .margin-input {
            flex: 1;
            text-align: center;
            padding: 6px;
            border: none;
            background: transparent;
            min-width: 35px;
            font-size: 13px;
        }

        .stepper .unit {
            padding: 0 6px;
            display: flex;
            align-items: center;
            color: #999;
            font-size: 11px;
            transition: color 0.3s ease;
        }

        body.dark-mode .stepper .unit {
            color: #888;
        }

        /* Margin ÈîÅÂÆöÊåâÈíÆ */
        .margin-lock {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            padding-right: 30px;
        }

        .lock-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            user-select: none;
            padding: 7px;
        }

        .lock-btn svg {
            width: 100%;
            height: 100%;
            color: #666;
            transition: color 0.2s, transform 0.2s;
            transform: rotate(-45deg);
        }

        .lock-btn:hover {
            background: #f8f8f8;
            border-color: #999;
        }

        .lock-btn:hover svg {
            color: #333;
        }

        .lock-btn.locked {
            background: #007bff;
            border-color: #007bff;
        }

        .lock-btn.locked svg {
            color: white;
        }

        body.dark-mode .lock-btn {
            background: #3a3a3a;
            border-color: #555;
        }

        body.dark-mode .lock-btn svg {
            color: #b0b0b0;
        }

        body.dark-mode .lock-btn:hover {
            background: #444;
            border-color: #666;
        }

        body.dark-mode .lock-btn:hover svg {
            color: #e0e0e0;
        }

        body.dark-mode .lock-btn.locked {
            background: #5a9fd4;
            border-color: #5a9fd4;
        }

        body.dark-mode .lock-btn.locked svg {
            color: white;
        }

        /* Canvas margin ÊòæÁ§∫‰∏∫Á∫ø */
        .canvas-margin {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1;
        }

        /* Canvas columns/rows ÂÆπÂô® */
        .canvas-columns,
        .canvas-rows {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Column Á∫øÔºàÁ∫µÂêëÔºåÂûÇÁõ¥Á∫øÔºâ*/
        .column-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #00ffff;
            opacity: 0.6;
            pointer-events: none;
        }

        /* Row Á∫øÔºàÊ®™ÂêëÔºåÊ∞¥Âπ≥Á∫øÔºâ*/
        .row-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: #00ffff;
            opacity: 0.6;
            pointer-events: none;
        }

        .canvas-margin.left {
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ff0080;
            border: none;
        }

        .canvas-margin.right {
            right: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ff0080;
            border: none;
        }

        .canvas-margin.top {
            left: 0;
            right: 0;
            top: 0;
            height: 2px;
            background: #ff0080;
            border: none;
        }

        .canvas-margin.bottom {
            left: 0;
            right: 0;
            bottom: 0;
            height: 2px;
            background: #ff0080;
            border: none;
        }

        /* ÊªöÂä®Êù°Ê†∑Âºè */
        .control-panel::-webkit-scrollbar {
            width: 6px;
        }

        .control-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .control-panel::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .control-panel::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ‰∏ªÈ¢òÂàáÊç¢ -->
        <div class="theme-toggle">
            <button class="theme-option" data-theme="auto" title="Ë∑üÈöèÁ≥ªÁªü">üåì</button>
            <button class="theme-option" data-theme="light" title="‰∫ÆËâ≤Ê®°Âºè">‚òÄÔ∏è</button>
            <button class="theme-option" data-theme="dark" title="ÊöóËâ≤Ê®°Âºè">üåô</button>
        </div>

        <div class="page-content">
            <!-- Ê†áÈ¢òÂå∫Âüü -->
            <div class="header">
                <svg class="logo" viewBox="0 0 877.08 391.85" xmlns="http://www.w3.org/2000/svg">
                    <g>
                        <path d="M14.2,343.24v-155.64h51.47c10.75,0,20.83,2.02,30.24,6.06,9.41,4.04,17.68,9.64,24.79,16.79,7.12,7.15,12.69,15.42,16.73,24.79,4.04,9.38,6.06,19.44,6.06,30.18s-2.02,20.81-6.06,30.18c-4.04,9.38-9.62,17.64-16.73,24.79-7.12,7.15-15.38,12.75-24.79,16.79-9.41,4.04-19.49,6.06-30.24,6.06H14.2ZM29.77,327.67h35.91c8.6,0,16.66-1.61,24.18-4.84,7.52-3.22,14.14-7.69,19.84-13.4s10.17-12.32,13.4-19.84c3.22-7.52,4.84-15.58,4.84-24.18s-1.61-16.66-4.84-24.18c-3.22-7.52-7.71-14.14-13.45-19.84-5.74-5.71-12.36-10.17-19.84-13.4-7.49-3.22-15.53-4.84-24.12-4.84H29.77v124.51Z"/>
                        <path d="M214.44,345.2c-11.48,0-21.94-2.95-31.38-8.86-9.44-5.9-16.97-13.83-22.58-23.77-5.61-9.94-8.42-20.94-8.42-33,0-9.15,1.62-17.7,4.87-25.64,3.24-7.94,7.71-14.93,13.41-20.96,5.7-6.03,12.33-10.75,19.9-14.16,7.57-3.41,15.64-5.12,24.2-5.12,9.23,0,17.74,1.83,25.51,5.49,7.78,3.66,14.47,8.78,20.09,15.35,5.61,6.57,9.86,14.27,12.73,23.08,2.87,8.82,4.05,18.34,3.56,28.57h-105.8c1,7.9,3.51,14.97,7.55,21.21,4.03,6.24,9.19,11.17,15.47,14.78,6.28,3.62,13.24,5.47,20.9,5.55,8.32,0,15.82-2.16,22.52-6.49,6.69-4.32,12.08-10.27,16.16-17.84l17.72,4.12c-4.99,11.06-12.52,20.11-22.58,27.14-10.07,7.03-21.34,10.54-33.81,10.54ZM170.03,272.09h88.71c-.58-7.74-2.93-14.83-7.05-21.27-4.12-6.44-9.42-11.6-15.91-15.47-6.49-3.87-13.6-5.8-21.33-5.8s-14.81,1.89-21.21,5.68c-6.41,3.79-11.65,8.9-15.72,15.35-4.08,6.45-6.57,13.62-7.49,21.52Z"/>
                        <path d="M731.95,345.2c-11.48,0-21.94-2.95-31.38-8.86-9.44-5.9-16.97-13.83-22.58-23.77-5.61-9.94-8.42-20.94-8.42-33,0-9.15,1.62-17.7,4.87-25.64,3.24-7.94,7.71-14.93,13.41-20.96,5.7-6.03,12.33-10.75,19.9-14.16,7.57-3.41,15.64-5.12,24.2-5.12,9.23,0,17.74,1.83,25.51,5.49,7.78,3.66,14.47,8.78,20.09,15.35,5.61,6.57,9.86,14.27,12.73,23.08,2.87,8.82,4.05,18.34,3.56,28.57h-105.8c1,7.9,3.51,14.97,7.55,21.21,4.03,6.24,9.19,11.17,15.47,14.78,6.28,3.62,13.24,5.47,20.9,5.55,8.32,0,15.82-2.16,22.52-6.49,6.69-4.32,12.08-10.27,16.16-17.84l17.72,4.12c-4.99,11.06-12.52,20.11-22.58,27.14-10.07,7.03-21.34,10.54-33.81,10.54ZM687.53,272.09h88.71c-.58-7.74-2.93-14.83-7.05-21.27-4.12-6.44-9.42-11.6-15.91-15.47-6.49-3.87-13.6-5.8-21.33-5.8s-14.81,1.89-21.21,5.68c-6.41,3.79-11.65,8.9-15.72,15.35-4.08,6.45-6.57,13.62-7.49,21.52Z"/>
                        <path d="M326.14,345.17c-6.83-.17-13.5-1.42-20-3.75s-12.17-5.5-17-9.5c-4.83-4-8.29-8.54-10.38-13.63l15.13-6.5c1.33,3.25,3.81,6.23,7.44,8.94,3.63,2.71,7.77,4.88,12.44,6.5,4.67,1.63,9.29,2.44,13.88,2.44,5.08,0,9.83-.83,14.25-2.5,4.42-1.67,8.02-4.06,10.81-7.19,2.79-3.13,4.19-6.81,4.19-11.06,0-4.58-1.5-8.19-4.5-10.81-3-2.63-6.79-4.71-11.38-6.25-4.58-1.54-9.29-3.02-14.13-4.44-8.83-2.42-16.63-5.08-23.38-8-6.75-2.92-12.02-6.64-15.81-11.19-3.79-4.54-5.69-10.4-5.69-17.56,0-7.58,2.14-14.15,6.44-19.69,4.29-5.54,9.92-9.83,16.88-12.88,6.96-3.04,14.4-4.56,22.31-4.56,10.17,0,19.44,2.21,27.82,6.63,8.38,4.42,14.44,10.29,18.19,17.63l-14.13,8.38c-1.5-3.42-3.88-6.38-7.13-8.88-3.25-2.5-6.94-4.46-11.06-5.88-4.13-1.42-8.31-2.17-12.56-2.25-5.33-.08-10.29.69-14.88,2.31-4.58,1.63-8.27,4.02-11.06,7.19-2.79,3.17-4.19,7.04-4.19,11.63s1.38,8.06,4.13,10.44c2.75,2.38,6.48,4.29,11.19,5.75,4.71,1.46,10.02,3.15,15.94,5.06,7.58,2.42,14.71,5.17,21.38,8.25,6.67,3.08,12.04,6.92,16.13,11.5,4.08,4.58,6.08,10.38,6,17.38,0,7.5-2.25,14.04-6.75,19.63-4.5,5.58-10.34,9.86-17.5,12.81-7.17,2.96-14.84,4.31-23,4.06Z"/>
                        <path d="M395.39,205.62c-2.67,0-4.92-.88-6.76-2.65-1.84-1.76-2.76-3.98-2.76-6.64s.92-4.88,2.76-6.64c1.84-1.76,4.1-2.65,6.76-2.65s4.8.88,6.64,2.65c1.84,1.76,2.76,3.98,2.76,6.64s-.9,4.88-2.7,6.64c-1.8,1.76-4.04,2.65-6.7,2.65ZM387.04,226.2h16.46v117.59h-16.46v-117.59Z"/>
                        <path d="M658.64,265.05v77.96h-17.63v-74.44c0-6.88-1.68-13.14-5.04-18.77-3.36-5.62-7.85-10.12-13.48-13.48-5.63-3.36-11.88-5.04-18.77-5.04s-13.04,1.68-18.7,5.04c-5.67,3.36-10.18,7.85-13.54,13.48-3.36,5.63-5.04,11.88-5.04,18.77v74.44h-17.63v-125.95h17.63v17.38c4.45-6.38,10.24-11.46,17.38-15.24,7.14-3.78,14.9-5.67,23.3-5.67,9.49,0,18.14,2.31,25.95,6.93,7.81,4.62,14.02,10.83,18.64,18.64,4.62,7.81,6.93,16.46,6.93,25.95Z"/>
                        <path d="M804.75,343.01v-125.79h17.61v17.36c4.44-6.37,10.23-11.45,17.36-15.22,7.13-3.77,14.88-5.66,23.27-5.66,4.86,0,9.56.63,14.09,1.89l-7.17,17.49c-3.52-1.09-6.96-1.64-10.31-1.64-6.79,0-13.02,1.68-18.68,5.03-5.66,3.36-10.17,7.84-13.52,13.46-3.35,5.62-5.03,11.87-5.03,18.74v74.34h-17.61Z"/>
                        <path d="M284.67,77.98h75.26v16.46h-75.26v-16.46Z"/>
                        <path d="M251.71,23.17c-2.67,0-4.92-.88-6.76-2.65-1.84-1.76-2.76-3.98-2.76-6.64s.92-4.88,2.76-6.64c1.84-1.76,4.1-2.65,6.76-2.65s4.8.88,6.64,2.65c1.84,1.76,2.76,3.98,2.76,6.64s-.9,4.88-2.7,6.64c-1.8,1.76-4.04,2.65-6.7,2.65ZM243.36,43.75h16.46v117.59h-16.46V43.75Z"/>
                        <path d="M77.21,162.61c-10.76,0-20.83-2.11-30.2-6.33-9.38-4.22-17.58-10.09-24.6-17.59-7.02-7.51-12.51-16.17-16.47-26-3.96-9.82-5.94-20.34-5.94-31.55s2.05-22.08,6.16-31.94c4.11-9.86,9.75-18.47,16.92-25.83,7.17-7.36,15.41-13.09,24.71-17.2C57.1,2.06,66.98,0,77.44,0c12.03,0,23.4,2.8,34.12,8.4,10.72,5.6,19.82,13.56,27.29,23.87l-14.01,7.62c-5.98-7.84-13.17-13.86-21.57-18.04-8.41-4.18-17.05-6.28-25.94-6.28s-16.38,1.7-23.81,5.1c-7.43,3.4-13.99,8.12-19.67,14.18-5.68,6.05-10.12,13.04-13.34,20.96-3.21,7.92-4.82,16.44-4.82,25.55s1.61,17.52,4.82,25.44c3.21,7.92,7.64,14.89,13.28,20.9,5.64,6.01,12.2,10.72,19.67,14.12,7.47,3.4,15.47,5.1,23.98,5.1,7.02,0,13.69-1.21,20-3.64,6.31-2.43,12.08-5.84,17.31-10.25,5.23-4.41,9.66-9.56,13.28-15.47,3.62-5.9,6.26-12.33,7.9-19.28h-42.36v-14.23h60.63c-.22,10.83-2.39,20.99-6.5,30.48-4.11,9.49-9.69,17.84-16.75,25.05-7.06,7.21-15.17,12.85-24.32,16.92-9.15,4.07-18.96,6.11-29.42,6.11Z"/>
                        <path d="M162.48,161.46V35.67h17.61v17.36c4.44-6.37,10.23-11.45,17.36-15.22,7.13-3.77,14.88-5.66,23.27-5.66,4.86,0,9.56.63,14.09,1.89l-7.17,17.49c-3.52-1.09-6.96-1.64-10.31-1.64-6.79,0-13.02,1.68-18.68,5.03-5.66,3.36-10.17,7.84-13.52,13.46-3.35,5.62-5.03,11.87-5.03,18.74v74.34h-17.61Z"/>
                        <path d="M516.03,216.69h16.35v121.1c0,7.47-1.62,14.48-4.85,21.02-3.23,6.54-7.59,12.28-13.08,17.22-5.49,4.94-11.74,8.82-18.74,11.62-7.01,2.8-14.29,4.2-21.84,4.2-8.1,0-15.92-1.85-23.47-5.55-7.55-3.7-14.11-8.62-19.68-14.77-5.57-6.15-9.52-12.96-11.85-20.44l15.06-6.89c1.48,5.84,4.26,11.11,8.35,15.82,4.09,4.71,8.91,8.45,14.48,11.21,5.57,2.76,11.27,4.15,17.11,4.15,5.37,0,10.57-.99,15.59-2.98,5.02-1.99,9.54-4.69,13.55-8.12,4.01-3.43,7.18-7.42,9.52-11.97,2.34-4.55,3.5-9.4,3.5-14.54v-25.81c-4.05,7.32-9.52,13.24-16.41,17.75-6.89,4.51-14.89,6.77-24,6.77-8.17,0-15.86-1.6-23.06-4.79-7.2-3.19-13.53-7.61-18.98-13.25-5.45-5.64-9.71-12.16-12.79-19.56-3.08-7.4-4.61-15.34-4.61-23.82s1.54-16.45,4.61-23.88c3.07-7.43,7.34-13.97,12.79-19.62,5.45-5.64,11.77-10.06,18.98-13.25,7.2-3.19,14.89-4.79,23.06-4.79,9.11,0,17.11,2.24,24,6.71,6.89,4.48,12.36,10.41,16.41,17.81v-21.37ZM475.74,320.62c8.1,0,15.08-2.1,20.96-6.31,5.88-4.2,10.41-9.77,13.6-16.7,3.19-6.93,4.79-14.44,4.79-22.54s-1.62-15.94-4.85-22.83c-3.23-6.89-7.81-12.42-13.72-16.58-5.92-4.16-12.85-6.25-20.79-6.25s-15.16,2.04-21.66,6.13c-6.5,4.09-11.66,9.6-15.47,16.52-3.82,6.93-5.72,14.6-5.72,23s1.95,16.06,5.84,22.95c3.89,6.89,9.09,12.38,15.59,16.47,6.5,4.09,13.64,6.13,21.43,6.13Z"/>
                    </g>
                </svg>
            </div>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
            <div class="main-content">
                <!-- Â∑¶‰æßÁîªÂ∏ÉÂå∫Âüü -->
                <div class="canvas-area" id="canvasArea">
                    <div class="canvas-container" id="canvasContainer">
                        <div class="canvas" id="canvas">
                            <div class="canvas-margin left" id="marginLeftVis"></div>
                            <div class="canvas-margin right" id="marginRightVis"></div>
                            <div class="canvas-margin top" id="marginTopVis"></div>
                            <div class="canvas-margin bottom" id="marginBottomVis"></div>
                            <div class="canvas-grid"></div>
                            <div class="canvas-columns" id="canvasColumns"></div>
                            <div class="canvas-rows" id="canvasRows"></div>
                        </div>
                    </div>
                    
                    <!-- Áº©ÊîæÊéßÂà∂ -->
                    <div class="zoom-controls">
                        <div class="zoom-btn" id="focusCanvas" title="ÈÄÇÈÖçÁîªÂ∏É">‚äô</div>
                        <div class="zoom-btn" id="zoomOut">‚àí</div>
                        <input type="text" class="zoom-display" id="zoomDisplay" value="100%">
                        <div class="zoom-btn" id="zoomIn">+</div>
                    </div>
                </div>

                <!-- Âè≥‰æßÊéßÂà∂Èù¢Êùø -->
                <div class="control-panel">
                    <!-- Page Size Section -->
                    <div class="section">
                        <div class="section-title">Page Size</div>
                        <div class="input-row">
                            <span class="label">WIDTH</span>
                            <input type="number" class="input" id="pageWidth" value="792" min="50" max="2000" step="1">
                            <span class="unit">pt</span>
                        </div>
                        <div class="input-row">
                            <span class="label">HEIGHT</span>
                            <input type="number" class="input" id="pageHeight" value="1224" min="50" max="2000" step="1">
                            <span class="unit">pt</span>
                        </div>
                    </div>

                    <!-- Module Section - Hidden (logic integrated into Grid Size) -->
                    <div class="section" style="display: none;">
                        <div class="section-title">Module</div>
                        <div class="input-row">
                            <input type="range" class="slider" id="moduleSlider" min="0" max="0" value="0" step="1">
                            <input type="text" class="input" id="moduleDisplay" value="-" readonly style="width: 60px; text-align: center;">
                                <span class="unit">pt</span>
                            </div>
                            </div>

                    <!-- Grid Size Section -->
                    <div class="section">
                        <div class="section-title">Grid Size</div>
                        <div class="input-row">
                            <input type="range" class="slider" id="gridSizeSlider" min="0" max="0" value="0" step="1">
                            <input type="text" class="input" id="gridSizeDisplay" value="-" readonly style="width: 60px; text-align: center;">
                                <span class="unit">pt</span>
                        </div>
                    </div>

                    <!-- Margin Section -->
                    <div class="section">
                        <div class="section-title">Margin</div>
                        <div class="margin-grid">
                            <!-- Left/Right Column -->
                            <div class="margin-column">
                                <div class="margin-controls-wrapper">
                                    <div class="margin-control">
                                        <span class="label">Left</span>
                                        <div class="stepper">
                                            <button class="stepper-btn" data-margin="left" data-dir="-1">‚àí</button>
                                            <input type="text" class="input margin-input" id="marginLeft" value="0" readonly>
                            <span class="unit">pt</span>
                                            <button class="stepper-btn" data-margin="left" data-dir="1">+</button>
                        </div>
                        </div>
                                    <div class="margin-control">
                                        <span class="label">Right</span>
                                        <div class="stepper">
                                            <button class="stepper-btn" data-margin="right" data-dir="-1">‚àí</button>
                                            <input type="text" class="input margin-input" id="marginRight" value="0" readonly>
                            <span class="unit">pt</span>
                                            <button class="stepper-btn" data-margin="right" data-dir="1">+</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="margin-lock">
                                    <button class="lock-btn" id="lockHorizontal" title="ÈîÅÂÆöÂ∑¶Âè≥">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="icon-unlocked"><rect width="256" height="256" fill="none"/><path d="M192,120l12.28-11.72a40,40,0,0,0-56.56-56.56L136,64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M64,136,51.72,147.72a40,40,0,0,0,56.56,56.56L120,192" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="192" y1="160" x2="216" y2="160" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="40" y1="96" x2="64" y2="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="160" y1="192" x2="160" y2="216" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="96" y1="40" x2="96" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="icon-locked" style="display: none;"><rect width="256" height="256" fill="none"/><path d="M141.38,64.68l11-11a46.62,46.62,0,0,1,65.94,0h0a46.62,46.62,0,0,1,0,65.94L193.94,144,183.6,154.34a46.63,46.63,0,0,1-66-.05h0A46.48,46.48,0,0,1,104,120.06" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M114.62,191.32l-11,11a46.63,46.63,0,0,1-66-.05h0a46.63,46.63,0,0,1,.06-65.89L72.4,101.66a46.62,46.62,0,0,1,65.94,0h0A46.45,46.45,0,0,1,152,135.94" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                                    </button>
                        </div>
                    </div>

                            <!-- Top/Bottom Column -->
                            <div class="margin-column">
                                <div class="margin-controls-wrapper">
                                    <div class="margin-control">
                                        <span class="label">Top</span>
                                        <div class="stepper">
                                            <button class="stepper-btn" data-margin="top" data-dir="-1">‚àí</button>
                                            <input type="text" class="input margin-input" id="marginTop" value="0" readonly>
                            <span class="unit">pt</span>
                                            <button class="stepper-btn" data-margin="top" data-dir="1">+</button>
                        </div>
                        </div>
                                    <div class="margin-control">
                                        <span class="label">Bottom</span>
                                        <div class="stepper">
                                            <button class="stepper-btn" data-margin="bottom" data-dir="-1">‚àí</button>
                                            <input type="text" class="input margin-input" id="marginBottom" value="0" readonly>
                            <span class="unit">pt</span>
                                            <button class="stepper-btn" data-margin="bottom" data-dir="1">+</button>
                        </div>
                    </div>
                        </div>
                                <div class="margin-lock">
                                    <button class="lock-btn" id="lockVertical" title="ÈîÅÂÆö‰∏ä‰∏ã">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="icon-unlocked"><rect width="256" height="256" fill="none"/><path d="M192,120l12.28-11.72a40,40,0,0,0-56.56-56.56L136,64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M64,136,51.72,147.72a40,40,0,0,0,56.56,56.56L120,192" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="192" y1="160" x2="216" y2="160" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="40" y1="96" x2="64" y2="96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="160" y1="192" x2="160" y2="216" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><line x1="96" y1="40" x2="96" y2="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" class="icon-locked" style="display: none;"><rect width="256" height="256" fill="none"/><path d="M141.38,64.68l11-11a46.62,46.62,0,0,1,65.94,0h0a46.62,46.62,0,0,1,0,65.94L193.94,144,183.6,154.34a46.63,46.63,0,0,1-66-.05h0A46.48,46.48,0,0,1,104,120.06" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/><path d="M114.62,191.32l-11,11a46.63,46.63,0,0,1-66-.05h0a46.63,46.63,0,0,1,.06-65.89L72.4,101.66a46.62,46.62,0,0,1,65.94,0h0A46.45,46.45,0,0,1,152,135.94" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>
                                    </button>
                        </div>
                            </div>
                        </div>
                    </div>

                    <!-- Column/Row Section -->
                    <div class="section">
                        <div class="section-title">Column/Row</div>
                        
                        <!-- Column Controls -->
                        <div class="input-group">
                            <div class="input-row">
                                <span class="label" style="min-width: 120px;">Column Spacing</span>
                                <div class="stepper" style="max-width: 160px;">
                                    <button class="stepper-btn" id="columnSpacingDown">‚àí</button>
                                    <input type="text" class="input margin-input" id="columnSpacing" value="-" readonly>
                                    <span class="unit">pt</span>
                                    <button class="stepper-btn" id="columnSpacingUp">+</button>
                                </div>
                            </div>
                            <div class="input-row">
                                <span class="label" style="min-width: 120px;">Column Number</span>
                                <input type="range" class="slider" id="columnSlider" min="0" max="0" value="0" step="1" disabled>
                                <input type="text" class="input" id="columnDisplay" value="-" readonly style="width: 60px; text-align: center;">
                            </div>
                        </div>
                        
                        <!-- Row Controls -->
                        <div class="input-group">
                            <div class="input-row">
                                <span class="label" style="min-width: 120px;">Row Spacing</span>
                                <div class="stepper" style="max-width: 160px;">
                                    <button class="stepper-btn" id="rowSpacingDown">‚àí</button>
                                    <input type="text" class="input margin-input" id="rowSpacing" value="-" readonly>
                                    <span class="unit">pt</span>
                                    <button class="stepper-btn" id="rowSpacingUp">+</button>
                                </div>
                            </div>
                            <div class="input-row">
                                <span class="label" style="min-width: 120px;">Row Number</span>
                                <input type="range" class="slider" id="rowSlider" min="0" max="0" value="0" step="1" disabled>
                                <input type="text" class="input" id="rowDisplay" value="-" readonly style="width: 60px; text-align: center;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GriDesigner {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.canvasContainer = document.getElementById('canvasContainer');
                this.scale = 1;
                this.isDragging = false;
                this.lastX = 0;
                this.lastY = 0;
                this.offsetX = 0;
                this.offsetY = 0;
                this.moduleOptions = [];
                this.currentModule = null;
                this.gridSizeOptions = [];
                this.currentGridSize = null;
                this.margins = { left: 0, top: 0, right: 0, bottom: 0 };
                this.marginLocks = { horizontal: true, vertical: true };
                this.currentTheme = 'auto'; // 'auto', 'light', 'dark'
                
                // Column/Row Áõ∏ÂÖ≥
                this.columnSpacing = null;  // ÈªòËÆ§‰∏∫ grid size
                this.rowSpacing = null;     // ÈªòËÆ§‰∏∫ grid size
                this.columnOptions = [];
                this.rowOptions = [];
                this.currentColumnNumber = null;
                this.currentRowNumber = null;
                
                this.init();
            }

            init() {
                this.setupTheme();
                this.setupEventListeners();
                this.setupCanvas();
            }

            setupTheme() {
                // ‰ªé localStorage ËØªÂèñ‰øùÂ≠òÁöÑ‰∏ªÈ¢òËÆæÁΩÆ
                const savedTheme = localStorage.getItem('theme') || 'auto';
                this.currentTheme = savedTheme;
                
                // Â∫îÁî®‰∏ªÈ¢ò
                this.applyTheme(savedTheme);
                
                // ÁõëÂê¨Á≥ªÁªü‰∏ªÈ¢òÂèòÂåñ
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', (e) => {
                    if (this.currentTheme === 'auto') {
                        this.applyTheme('auto');
                    }
                });
                
                // ËÆæÁΩÆ‰∏ªÈ¢òÊåâÈíÆ‰∫ã‰ª∂
                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.currentTarget.getAttribute('data-theme');
                        this.setTheme(theme);
                    });
                });
            }

            setTheme(theme) {
                this.currentTheme = theme;
                localStorage.setItem('theme', theme);
                this.applyTheme(theme);
            }

            applyTheme(theme) {
                const body = document.body;
                
                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                document.querySelectorAll('.theme-option').forEach(btn => {
                    if (btn.getAttribute('data-theme') === theme) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Â∫îÁî®‰∏ªÈ¢ò
                if (theme === 'dark') {
                    body.classList.add('dark-mode');
                } else if (theme === 'light') {
                    body.classList.remove('dark-mode');
                } else if (theme === 'auto') {
                    // Ë∑üÈöèÁ≥ªÁªü
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (prefersDark) {
                        body.classList.add('dark-mode');
                    } else {
                        body.classList.remove('dark-mode');
                    }
                }
            }

            setupEventListeners() {
                // ÁîªÂ∏ÉÁº©Êîæ - ÈÄüÂ∫¶‰∏éÊªöËΩÆÈáèÊàêÊ≠£ÊØî
                this.canvasContainer.parentElement.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    // ËÆ°ÁÆóÁº©ÊîæÂ¢ûÈáèÔºå‰∏éÊªöÂä®ÈáèÊàêÊ≠£ÊØî
                    const zoomSpeed = 0.001; // Ë∞ÉÊï¥Ëøô‰∏™ÂÄºÊù•ÊéßÂà∂Êï¥‰ΩìÁº©ÊîæÈÄüÂ∫¶
                    const deltaScale = -e.deltaY * zoomSpeed; // Ë¥üÂè∑ÊòØÂõ†‰∏∫deltaYÂêë‰∏ã‰∏∫Ê≠£ÔºåÊàë‰ª¨Ë¶ÅÊîæÂ§ß
                    this.scale += this.scale * deltaScale; // ÊåâÂΩìÂâçÁº©ÊîæÁöÑÁôæÂàÜÊØîÂ¢ûÂáè
                    this.scale = Math.max(0.05, Math.min(5, this.scale));
                    this.updateCanvasTransform();
                    this.updateZoomDisplay();
                });

                // ÁîªÂ∏ÉÊãñÊãΩ
                this.canvasContainer.parentElement.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    this.lastX = e.clientX;
                    this.lastY = e.clientY;
                    this.canvasContainer.parentElement.style.cursor = 'grabbing';
                });

                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        const deltaX = e.clientX - this.lastX;
                        const deltaY = e.clientY - this.lastY;
                        this.offsetX += deltaX;
                        this.offsetY += deltaY;
                        this.lastX = e.clientX;
                        this.lastY = e.clientY;
                        this.updateCanvasTransform();
                    }
                });

                document.addEventListener('mouseup', () => {
                    if (this.isDragging) {
                    this.isDragging = false;
                        this.canvasContainer.parentElement.style.cursor = 'default';
                    }
                });

                // Focus ÊåâÈíÆ - ÈÄÇÈÖçÁîªÂ∏É
                document.getElementById('focusCanvas').addEventListener('click', () => {
                    const widthPt = parseFloat(document.getElementById('pageWidth').value);
                    const heightPt = parseFloat(document.getElementById('pageHeight').value);
                    if (widthPt && heightPt) {
                        this.fitCanvasToView(widthPt, heightPt, true); // ÂêØÁî®Âä®Áîª
                    }
                });

                // Áº©ÊîæÊåâÈíÆ - round to ÊúÄËøëÁöÑ ¬±25%
                document.getElementById('zoomIn').addEventListener('click', () => {
                    this.zoomToNearest25(1); // +1 Ë°®Á§∫Âêë‰∏ä
                });

                document.getElementById('zoomOut').addEventListener('click', () => {
                    this.zoomToNearest25(-1); // -1 Ë°®Á§∫Âêë‰∏ã
                });

                // Áº©ÊîæËæìÂÖ•Ê°Ü
                const zoomInput = document.getElementById('zoomDisplay');
                
                // ÈôêÂà∂Âè™ËÉΩËæìÂÖ•Êï∞Â≠ó
                zoomInput.addEventListener('keydown', (e) => {
                    this.restrictToNumbers(e, true); // true Ë°®Á§∫ÂÖÅËÆ∏Â∞èÊï∞ÁÇπ
                });
                
                // ÈôêÂà∂Á≤òË¥¥ÂÜÖÂÆπ
                zoomInput.addEventListener('paste', (e) => {
                    this.handleNumberPaste(e);
                });
                
                zoomInput.addEventListener('change', (e) => {
                    this.handleZoomInput(e.target.value);
                });
                
                zoomInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleZoomInput(e.target.value);
                        e.target.blur();
                    }
                });

                // ÊéßÂà∂Èù¢Êùø‰∫§‰∫í
                this.setupControlPanel();
            }

            zoomToNearest25(direction) {
                const currentPercent = this.scale * 100;
                let targetPercent;
                
                if (direction > 0) {
                    // Âêë‰∏ä roundÔºöÊâæÂà∞‰∏ã‰∏Ä‰∏™ 25 ÁöÑÂÄçÊï∞
                    targetPercent = Math.ceil(currentPercent / 25) * 25;
                    // Â¶ÇÊûúÂΩìÂâçÂ∑≤ÁªèÊòØ 25 ÁöÑÂÄçÊï∞ÔºåÂ∞±Âä† 25
                    if (targetPercent === currentPercent) {
                        targetPercent += 25;
                    }
                    // ÈôêÂà∂ËåÉÂõ¥
                    targetPercent = Math.max(5, Math.min(500, targetPercent));
                    this.scale = targetPercent / 100;
                    this.updateCanvasTransform(true); // ÂêØÁî®Âä®Áîª
                    this.updateZoomDisplay();
                } else {
                    // Âêë‰∏ã roundÔºöÊâæÂà∞‰∏ä‰∏Ä‰∏™ 25 ÁöÑÂÄçÊï∞
                    targetPercent = Math.floor(currentPercent / 25) * 25;
                    // Â¶ÇÊûúÂΩìÂâçÂ∑≤ÁªèÊòØ 25 ÁöÑÂÄçÊï∞ÔºåÂ∞±Âáè 25
                    if (targetPercent === currentPercent) {
                        targetPercent -= 25;
                    }
                    
                    // Â¶ÇÊûúË¶ÅÁº©Â∞èÂà∞ 25% ‰ª•‰∏ãÔºåÊ£ÄÊü•ÁîªÂ∏ÉÊòØÂê¶ËÉΩÂÆåÂÖ®Â±ïÁ§∫
                    if (targetPercent < 25) {
                        // Ëé∑ÂèñÂΩìÂâçÁîªÂ∏ÉÂ∞∫ÂØ∏
                        const widthPt = parseFloat(document.getElementById('pageWidth').value);
                        const heightPt = parseFloat(document.getElementById('pageHeight').value);
                        
                        if (widthPt && heightPt) {
                            // ËÆ°ÁÆóËÉΩÂÆåÂÖ®Â±ïÁ§∫ÁîªÂ∏ÉÁöÑÁº©ÊîæÊØî‰æã
                            const canvasWidthPx = this.ptToPx(widthPt);
                            const canvasHeightPx = this.ptToPx(heightPt);
                            const canvasArea = this.canvasContainer.parentElement;
                            const areaWidth = canvasArea.clientWidth;
                            const areaHeight = canvasArea.clientHeight;
                            const margin = 20;
                            const availableWidth = areaWidth - margin * 2;
                            const availableHeight = areaHeight - margin * 2;
                            const scaleX = availableWidth / canvasWidthPx;
                            const scaleY = availableHeight / canvasHeightPx;
                            const fitScale = Math.min(scaleX, scaleY, 3);
                            const fitPercent = fitScale * 100;
                            
                            // Â¶ÇÊûúÂú® 25% Êó∂ÁîªÂ∏ÉËøò‰∏çËÉΩÂÆåÂÖ®Â±ïÁ§∫ÔºåÂ∞±Áõ¥Êé•Ë∑≥Âà∞ÈÄÇÈÖçÊØî‰æã
                            if (fitPercent < 25) {
                                this.scale = fitScale;
                                this.offsetX = 0;
                                this.offsetY = 0;
                                this.updateCanvasTransform(true); // ÂêØÁî®Âä®Áîª
                                this.updateZoomDisplay();
                                return;
                            }
                        }
                    }
                    
                    // Âê¶ÂàôÊ≠£Â∏∏Áº©Â∞èÂà∞ÁõÆÊ†áÁôæÂàÜÊØî
                    targetPercent = Math.max(5, Math.min(500, targetPercent));
                    this.scale = targetPercent / 100;
                    this.updateCanvasTransform(true); // ÂêØÁî®Âä®Áîª
                    this.updateZoomDisplay();
                }
            }

            handleZoomInput(value) {
                // ÁßªÈô§ % Á¨¶Âè∑Âπ∂Ëß£ÊûêÊï∞Â≠ó
                const numValue = parseFloat(value.replace('%', ''));
                if (!isNaN(numValue) && numValue > 0) {
                    // ÈôêÂà∂ËåÉÂõ¥ 5% - 500%
                    this.scale = Math.max(0.05, Math.min(5, numValue / 100));
                    this.updateCanvasTransform(true); // ÂêØÁî®Âä®Áîª
                }
                this.updateZoomDisplay();
            }

            updateZoomDisplay() {
                const zoomPercent = Math.round(this.scale * 100);
                document.getElementById('zoomDisplay').value = zoomPercent + '%';
            }

            setupCanvas() {
                // ËÆæÁΩÆÂàùÂßãÁîªÂ∏ÉÂ§ßÂ∞è
                this.updateCanvasSize();
                // ÂàùÂßãÂåñÁº©ÊîæÊòæÁ§∫
                this.updateZoomDisplay();
                // ÂàùÂßãÂåñ module ÈÄâÈ°π
                this.updateModuleOptions();
                // ÂàùÂßãÂåñ margin ÊòæÁ§∫
                this.updateCanvasMargins();
                // ÂàùÂßãÂåñ margin ÊåâÈíÆÁä∂ÊÄÅ
                this.updateMarginButtonsState();
            }

            // Â∞ÜptËΩ¨Êç¢‰∏∫pxÁî®‰∫éËÆ°ÁÆóÊòæÁ§∫Â∞∫ÂØ∏ (1pt = 4/3 px)
            ptToPx(pt) {
                return pt * 4 / 3;
            }

            // Ë¥®Âõ†Êï∞ÂàÜËß£ - ËøîÂõû [(prime, power), ...] Ê†ºÂºè
            getPrimeFactorization(n) {
                if (n < 2) return [];
                
                const factors = [];
                
                // ÂàÜËß£Âá∫ÊâÄÊúâÁöÑ2
                let count = 0;
                while (n % 2 === 0) {
                    count++;
                    n = Math.floor(n / 2);
                }
                if (count > 0) {
                    factors.push([2, count]);
                }
                
                // ÂàÜËß£Â•áÊï∞Ë¥®Âõ†Êï∞
                let p = 3;
                while (p * p <= n) {
                    count = 0;
                    while (n % p === 0) {
                        count++;
                        n = Math.floor(n / p);
                    }
                    if (count > 0) {
                        factors.push([p, count]);
                    }
                    p += 2;
                }
                
                // Â¶ÇÊûúÂâ©‰ΩôÁöÑn > 1ÔºåËØ¥ÊòéÂÆÉÊú¨Ë∫´ÊòØË¥®Êï∞
                if (n > 1) {
                    factors.push([n, 1]);
                }
                
                return factors;
            }

            // Ëé∑ÂèñË¥®Âõ†Êï∞ÂàóË°®Ôºà‰∏çÂ∏¶ powerÔºâ
            getPrimeFactors(n) {
                const factorization = this.getPrimeFactorization(n);
                const factors = [];
                for (const [prime, power] of factorization) {
                    for (let i = 0; i < power; i++) {
                        factors.push(prime);
                    }
                }
                return factors;
            }

            // ÊâæÂà∞‰∏§‰∏™Êï∞ÁöÑÂÖ±ÂêåË¥®Âõ†Êï∞
            findCommonPrimeFactors(x, y) {
                const xFactors = this.getPrimeFactors(x);
                const yFactors = this.getPrimeFactors(y);
                
                // ÊâæÂà∞ÂÖ±ÂêåÁöÑË¥®Âõ†Êï∞ÔºàÂéªÈáçÔºâ
                const commonFactors = [];
                const ySet = new Set(yFactors);
                
                for (const factor of xFactors) {
                    if (ySet.has(factor) && !commonFactors.includes(factor)) {
                        commonFactors.push(factor);
                    }
                }
                
                return commonFactors.sort((a, b) => a - b);
            }

            // Êõ¥Êñ∞ module ÈÄâÈ°π
            updateModuleOptions() {
                const width = parseInt(document.getElementById('pageWidth').value);
                const height = parseInt(document.getElementById('pageHeight').value);
                
                if (!width || !height || width < 2 || height < 2) {
                    this.moduleOptions = [];
                    this.updateModuleUI();
                    return;
                }
                
                // ÊâæÂà∞ÂÖ±ÂêåÁöÑË¥®Âõ†Êï∞
                this.moduleOptions = this.findCommonPrimeFactors(width, height);
                
                console.log(`Width: ${width}, Height: ${height}`);
                console.log(`Common prime factors: ${this.moduleOptions.join(', ')}`);
                
                this.updateModuleUI();
            }

            // Êõ¥Êñ∞ module UI
            updateModuleUI() {
                const slider = document.getElementById('moduleSlider');
                const display = document.getElementById('moduleDisplay');
                
                // Module UI Â∑≤ÈöêËóèÔºå‰ΩÜ‰øùÁïôÈÄªËæë‰ª•‰æøÂÖºÂÆπ
                if (this.moduleOptions.length === 0) {
                    slider.disabled = true;
                    slider.min = 0;
                    slider.max = 0;
                    slider.value = 0;
                    display.value = '-';
                    this.currentModule = null;
                } else {
                    slider.disabled = false;
                    slider.min = 0;
                    slider.max = this.moduleOptions.length - 1;
                    slider.value = 0;
                    this.currentModule = this.moduleOptions[0];
                    display.value = this.currentModule;
                }
                
                // Êõ¥Êñ∞ grid size ÈÄâÈ°πÔºàÁé∞Âú®‰ºöËÆ°ÁÆóÊâÄÊúâÂèØËÉΩÁöÑ moduleÔºâ
                this.updateGridSizeOptions();
            }

            // ËÆ°ÁÆó grid size ÈÄâÈ°π - ÈÅçÂéÜÊâÄÊúâÂèØËÉΩÁöÑ module
            calculateGridSizeOptions() {
                const width = parseInt(document.getElementById('pageWidth').value);
                const height = parseInt(document.getElementById('pageHeight').value);

                if (!width || !height || width < 2 || height < 2) {
                    return [];
                }

                // Â¶ÇÊûúÊ≤°ÊúâÂèØÁî®ÁöÑ moduleÔºåËøîÂõûÁ©∫Êï∞ÁªÑ
                if (!this.moduleOptions || this.moduleOptions.length === 0) {
                    return [];
                }

                // ÂêàÂπ∂ÊâÄÊúâ module ÂØπÂ∫îÁöÑ grid size
                const allGridSizes = new Set();

                // ÈÅçÂéÜÊâÄÊúâÂèØËÉΩÁöÑ module
                for (const m of this.moduleOptions) {
                    // Ëé∑Âèñ x Âíå y ÁöÑË¥®Âõ†Êï∞ÂàÜËß£
                    const xFactorization = this.getPrimeFactorization(width);
                    const yFactorization = this.getPrimeFactorization(height);

                    // ‰ªé x Âíå y ÁöÑË¥®Âõ†Êï∞ÂàÜËß£‰∏≠Èô§Âéª‰∏Ä‰∏™ m
                    const xRemainder = this.removeFactorFromFactorization(xFactorization, m);
                    const yRemainder = this.removeFactorFromFactorization(yFactorization, m);

                    // ÂêàÂπ∂ x Âíå y ÁöÑÂâ©‰ΩôÂõ†Êï∞ÔºåÂæóÂà∞ÊâÄÊúâÂèØÁî®ÁöÑË¥®Âõ†Êï∞ÔºàÂèñÊúÄÂ∞èpowerÔºâ
                    const availableFactors = this.mergeFactorizations(xRemainder, yRemainder);

                    // ÈÄíÂΩíÁîüÊàêÊâÄÊúâÁªÑÂêà
                    const generateCombinations = (factors, index, current) => {
                        const value = current * m;
                        if (value >= 5 && value <= 50) {
                            allGridSizes.add(value);
                        }
                        
                        if (index >= factors.length) {
                            return;
                        }
                        
                        const [prime, maxPower] = factors[index];
                        // ‰∏çÈÄâËøô‰∏™Ë¥®Âõ†Êï∞
                        generateCombinations(factors, index + 1, current);
                        // ÈÄâÊã©Ëøô‰∏™Ë¥®Âõ†Êï∞ÁöÑ‰∏çÂêåÂπÇÊ¨°
                        for (let power = 1; power <= maxPower; power++) {
                            generateCombinations(factors, index + 1, current * Math.pow(prime, power));
                        }
                    };
                    
                    generateCombinations(availableFactors, 0, 1);
                }

                // ËΩ¨Êç¢‰∏∫ÊéíÂ∫èÊï∞ÁªÑ
                return Array.from(allGridSizes).sort((a, b) => a - b);
            }

            // ‰ªéË¥®Âõ†Êï∞ÂàÜËß£‰∏≠Èô§Âéª‰∏Ä‰∏™Âõ†Â≠ê
            removeFactorFromFactorization(factorization, factor) {
                const factorFactorization = this.getPrimeFactorization(factor);
                const result = JSON.parse(JSON.stringify(factorization)); // Ê∑±Êã∑Ë¥ù

                for (const [prime, power] of factorFactorization) {
                    for (let i = 0; i < result.length; i++) {
                        if (result[i][0] === prime) {
                            result[i][1] -= power;
                            if (result[i][1] <= 0) {
                                result.splice(i, 1);
                            }
                            break;
                        }
                    }
                }

                return result;
            }

            // ÂêàÂπ∂‰∏§‰∏™Ë¥®Âõ†Êï∞ÂàÜËß£ÔºåÂèñÊúÄÂ∞è powerÔºàÁ°Æ‰øù grid size ËÉΩÂêåÊó∂Êï¥Èô§ width Âíå heightÔºâ
            mergeFactorizations(f1, f2) {
                const merged = new Map();

                // ÂÖàÊî∂ÈõÜÊâÄÊúâÁöÑË¥®Âõ†Êï∞
                for (const [prime, power] of f1) {
                    merged.set(prime, power);
                }

                // ÂØπ‰∫éÂú®‰∏§ËÄÖ‰∏≠ÈÉΩÂ≠òÂú®ÁöÑË¥®Âõ†Êï∞ÔºåÂèñÊúÄÂ∞è power
                // ÂØπ‰∫éÂè™Âú®‰∏Ä‰∏™‰∏≠Â≠òÂú®ÁöÑË¥®Âõ†Êï∞Ôºå‰∏çÂåÖÂê´ÔºàÂõ†‰∏∫‰∏çËÉΩÊï¥Èô§Âè¶‰∏Ä‰∏™Ôºâ
                const result = new Map();
                for (const [prime, power] of f2) {
                    if (merged.has(prime)) {
                        result.set(prime, Math.min(merged.get(prime), power));
                    }
                }

                return Array.from(result.entries());
            }

            // Êõ¥Êñ∞ grid size ÈÄâÈ°π
            updateGridSizeOptions() {
                this.gridSizeOptions = this.calculateGridSizeOptions();
                
                console.log(`Available modules: ${this.moduleOptions.join(', ')}`);
                console.log(`Grid size options (combined from all modules): ${this.gridSizeOptions.join(', ')}`);
                
                this.updateGridSizeUI();
            }

            // Êõ¥Êñ∞ grid size UI
            updateGridSizeUI() {
                const slider = document.getElementById('gridSizeSlider');
                const display = document.getElementById('gridSizeDisplay');
                const oldGridSize = this.currentGridSize;
                
                if (this.gridSizeOptions.length === 0) {
                    slider.disabled = true;
                    slider.min = 0;
                    slider.max = 0;
                    slider.value = 0;
                    display.value = '-';
                    this.currentGridSize = null;
                } else {
                    slider.disabled = false;
                    slider.min = 0;
                    slider.max = this.gridSizeOptions.length - 1;
                    slider.value = 0;
                    this.currentGridSize = this.gridSizeOptions[0];
                    display.value = this.currentGridSize;
                    this.updateCanvasGrid();
                }
                
                // Â¶ÇÊûú grid size ÂèòÂåñ‰∫ÜÔºåË∞ÉÊï¥Áé∞ÊúâÁöÑ margin ÂÄºÂà∞Êñ∞ grid size ÁöÑÂÄçÊï∞
                if (oldGridSize !== this.currentGridSize && this.currentGridSize) {
                    this.adjustMarginsToGridSize();
                }
                
                // Êõ¥Êñ∞ margin ÊåâÈíÆÁä∂ÊÄÅ
                this.updateMarginButtonsState();
            }

            // Â∞ÜÁé∞Êúâ margin Ë∞ÉÊï¥Âà∞Êñ∞ grid size ÁöÑÂÄçÊï∞
            adjustMarginsToGridSize() {
                const gridSize = this.currentGridSize;
                if (!gridSize) return;
                
                ['left', 'right', 'top', 'bottom'].forEach(side => {
                    const currentValue = this.margins[side];
                    if (currentValue > 0) {
                        // Âêë‰∏ãÂèñÊï¥Âà∞ÊúÄËøëÁöÑ grid size ÂÄçÊï∞
                        const newValue = Math.floor(currentValue / gridSize) * gridSize;
                        this.margins[side] = newValue;
                        document.getElementById(`margin${side.charAt(0).toUpperCase() + side.slice(1)}`).value = newValue;
                    }
                });
                
                this.updateCanvasMargins();
                console.log(`Margins adjusted to grid size: ${gridSize} pt`);
            }

            // Êõ¥Êñ∞ margin ÊåâÈíÆÁöÑÂêØÁî®/Á¶ÅÁî®Áä∂ÊÄÅ
            updateMarginButtonsState() {
                const buttons = document.querySelectorAll('.stepper-btn');
                buttons.forEach(btn => {
                    btn.disabled = !this.currentGridSize;
                });
            }

            // Êõ¥Êñ∞ÁîªÂ∏É‰∏äÁöÑÁΩëÊ†º
            updateCanvasGrid() {
                const grid = document.querySelector('.canvas-grid');
                if (!grid) {
                    return;
                }

                if (!this.currentGridSize) {
                    // Â¶ÇÊûúÊ≤°Êúâ grid sizeÔºåÈöêËóèÁΩëÊ†º
                    grid.style.opacity = '0';
                    return;
                }

                // ÊòæÁ§∫ÁΩëÊ†º
                grid.style.opacity = '0.3';

                // ‰ΩøÁî® pt Âçï‰ΩçÁõ¥Êé•ËÆæÁΩÆÔºåËøôÊ†∑‰ºöË∑üÈöèÁîªÂ∏É‰∏ÄËµ∑Áº©Êîæ
                grid.style.backgroundSize = `${this.currentGridSize}pt ${this.currentGridSize}pt`;
                
                console.log(`Grid updated: ${this.currentGridSize} pt`);
            }

            updateCanvasTransform(animate = false) {
                if (animate) {
                    this.canvasContainer.classList.add('animating');
                    this.canvasContainer.style.transform = 
                        `translate(calc(-50% + ${this.offsetX}px), calc(-50% + ${this.offsetY}px)) scale(${this.scale})`;
                    setTimeout(() => {
                        this.canvasContainer.classList.remove('animating');
                    }, 300);
                } else {
                    this.canvasContainer.style.transform = 
                        `translate(calc(-50% + ${this.offsetX}px), calc(-50% + ${this.offsetY}px)) scale(${this.scale})`;
                }
            }

            setupControlPanel() {
                // È°µÈù¢Â∞∫ÂØ∏ÊéßÂà∂
                const widthInput = document.getElementById('pageWidth');
                const heightInput = document.getElementById('pageHeight');
                
                // ÈôêÂà∂Âè™ËÉΩËæìÂÖ•Êï∞Â≠ó
                widthInput.addEventListener('keydown', (e) => {
                    this.restrictToNumbers(e, true);
                });
                
                heightInput.addEventListener('keydown', (e) => {
                    this.restrictToNumbers(e, true);
                });
                
                // ÈôêÂà∂Á≤òË¥¥ÂÜÖÂÆπ
                widthInput.addEventListener('paste', (e) => {
                    this.handleNumberPaste(e);
                });
                
                heightInput.addEventListener('paste', (e) => {
                    this.handleNumberPaste(e);
                });
                
                widthInput.addEventListener('input', () => {
                    this.updateCanvasSize();
                    
                    // ÈáçÁΩÆ column/row ËÆæÁΩÆÔºàÈ°µÈù¢Â∞∫ÂØ∏ÊîπÂèòÂΩ±ÂìçÊâÄÊúâËÆ°ÁÆóÔºâ
                    this.resetColumnRowSettings();
                    
                    this.updateModuleOptions();
                });

                heightInput.addEventListener('input', () => {
                    this.updateCanvasSize();
                    
                    // ÈáçÁΩÆ column/row ËÆæÁΩÆÔºàÈ°µÈù¢Â∞∫ÂØ∏ÊîπÂèòÂΩ±ÂìçÊâÄÊúâËÆ°ÁÆóÔºâ
                    this.resetColumnRowSettings();
                    
                    this.updateModuleOptions();
                });

                // Module ÊªëÊùÜÊéßÂà∂
                const moduleSlider = document.getElementById('moduleSlider');
                moduleSlider.addEventListener('input', (e) => {
                    const index = parseInt(e.target.value);
                    if (index >= 0 && index < this.moduleOptions.length) {
                        this.currentModule = this.moduleOptions[index];
                        document.getElementById('moduleDisplay').value = this.currentModule;
                        console.log(`Module set to: ${this.currentModule} pt`);
                        
                        // Êõ¥Êñ∞ grid size ÈÄâÈ°πÔºà‰∏çÈáçÁΩÆ column/rowÔºåÁ≠â grid size ÁúüÊ≠£ÊîπÂèòÊó∂ÂÜçÂ§ÑÁêÜÔºâ
                        this.updateGridSizeOptions();
                    }
                });

                // Grid Size ÊªëÊùÜÊéßÂà∂
                const gridSizeSlider = document.getElementById('gridSizeSlider');
                gridSizeSlider.addEventListener('input', (e) => {
                    const index = parseInt(e.target.value);
                    if (index >= 0 && index < this.gridSizeOptions.length) {
                        const oldGridSize = this.currentGridSize;
                        this.currentGridSize = this.gridSizeOptions[index];
                        document.getElementById('gridSizeDisplay').value = this.currentGridSize;
                        this.updateCanvasGrid();
                        
                        // Ë∞ÉÊï¥Áé∞Êúâ margin Âà∞Êñ∞ÁöÑ grid size ÂÄçÊï∞
                        if (oldGridSize !== this.currentGridSize) {
                            this.adjustMarginsToGridSize();
                        }
                        
                        // Ëá™ÈÄÇÂ∫î column/row spacing
                        if (!oldGridSize) {
                            // Â¶ÇÊûú‰πãÂâçÊ≤°Êúâ grid sizeÔºåÂàùÂßãÂåñ spacing
                            this.initializeColumnRowSpacing();
                        } else {
                            // Â¶ÇÊûú‰πãÂâçÊúâ grid sizeÔºåË∞ÉÊï¥ spacing ‰∏∫Êñ∞ grid size ÁöÑÂÄçÊï∞
                            this.adjustColumnRowSpacingToGridSize();
                        }
                        
                        console.log(`Grid size set to: ${this.currentGridSize} pt`);
                    }
                });

                // Column Spacing ÊéßÂà∂ÊåâÈíÆ
                document.getElementById('columnSpacingDown').addEventListener('click', () => {
                    this.adjustColumnSpacing(-1);
                });
                
                document.getElementById('columnSpacingUp').addEventListener('click', () => {
                    this.adjustColumnSpacing(1);
                });

                // Row Spacing ÊéßÂà∂ÊåâÈíÆ
                document.getElementById('rowSpacingDown').addEventListener('click', () => {
                    this.adjustRowSpacing(-1);
                });
                
                document.getElementById('rowSpacingUp').addEventListener('click', () => {
                    this.adjustRowSpacing(1);
                });

                // Column Number ÊªëÊùÜÊéßÂà∂
                const columnSlider = document.getElementById('columnSlider');
                columnSlider.addEventListener('input', (e) => {
                    const index = parseInt(e.target.value);
                    if (index >= 0 && index < this.columnOptions.length) {
                        this.currentColumnNumber = this.columnOptions[index];
                        document.getElementById('columnDisplay').value = this.currentColumnNumber;
                        this.drawColumns();
                        console.log(`Column number set to: ${this.currentColumnNumber}`);
                    }
                });

                // Row Number ÊªëÊùÜÊéßÂà∂
                const rowSlider = document.getElementById('rowSlider');
                rowSlider.addEventListener('input', (e) => {
                    const index = parseInt(e.target.value);
                    if (index >= 0 && index < this.rowOptions.length) {
                        this.currentRowNumber = this.rowOptions[index];
                        document.getElementById('rowDisplay').value = this.currentRowNumber;
                        this.drawRows();
                        console.log(`Row number set to: ${this.currentRowNumber}`);
                    }
                });

                // Margin ÊéßÂà∂ÊåâÈíÆ
                document.querySelectorAll('.stepper-btn[data-margin]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const margin = e.currentTarget.getAttribute('data-margin');
                        const dir = parseInt(e.currentTarget.getAttribute('data-dir'));
                        this.adjustMargin(margin, dir);
                    });
                });

                // Margin ÈîÅÂÆöÊåâÈíÆ
                document.getElementById('lockHorizontal').addEventListener('click', () => {
                    this.toggleMarginLock('horizontal');
                });

                document.getElementById('lockVertical').addEventListener('click', () => {
                    this.toggleMarginLock('vertical');
                });

                // ÂàùÂßãÂåñÈîÅÂÆöÊåâÈíÆÁä∂ÊÄÅ
                this.initMarginLockUI();
            }

            // ÂàùÂßãÂåñÈîÅÂÆöÊåâÈíÆ UI
            initMarginLockUI() {
                ['horizontal', 'vertical'].forEach(type => {
                    const btn = document.getElementById(type === 'horizontal' ? 'lockHorizontal' : 'lockVertical');
                    const unlockedIcon = btn.querySelector('.icon-unlocked');
                    const lockedIcon = btn.querySelector('.icon-locked');
                    
                    if (this.marginLocks[type]) {
                        btn.classList.add('locked');
                        unlockedIcon.style.display = 'none';
                        lockedIcon.style.display = 'block';
                    } else {
                        btn.classList.remove('locked');
                        unlockedIcon.style.display = 'block';
                        lockedIcon.style.display = 'none';
                    }
                });
            }

            // ÂàáÊç¢ margin ÈîÅÂÆö
            toggleMarginLock(type) {
                this.marginLocks[type] = !this.marginLocks[type];
                const btn = document.getElementById(type === 'horizontal' ? 'lockHorizontal' : 'lockVertical');
                const unlockedIcon = btn.querySelector('.icon-unlocked');
                const lockedIcon = btn.querySelector('.icon-locked');
                
                if (this.marginLocks[type]) {
                    btn.classList.add('locked');
                    unlockedIcon.style.display = 'none';
                    lockedIcon.style.display = 'block';
                    
                    // ÈîÅÂÆöÊó∂ÔºåÂ∞Ü‰∏§‰∏™ÂÄºËÆæ‰∏∫Áõ∏Á≠âÔºàÂèñËæÉÂ§ßÂÄºÔºâ
                    if (type === 'horizontal') {
                        const maxValue = Math.max(this.margins.left, this.margins.right);
                        this.margins.left = maxValue;
                        this.margins.right = maxValue;
                        document.getElementById('marginLeft').value = maxValue;
                        document.getElementById('marginRight').value = maxValue;
                    } else {
                        const maxValue = Math.max(this.margins.top, this.margins.bottom);
                        this.margins.top = maxValue;
                        this.margins.bottom = maxValue;
                        document.getElementById('marginTop').value = maxValue;
                        document.getElementById('marginBottom').value = maxValue;
                    }
                    this.updateCanvasMargins();
                } else {
                    btn.classList.remove('locked');
                    unlockedIcon.style.display = 'block';
                    lockedIcon.style.display = 'none';
                }
            }

            // Ë∞ÉÊï¥ margin
            adjustMargin(side, direction) {
                const step = this.currentGridSize || 1;
                const newValue = Math.max(0, this.margins[side] + (direction * step));
                this.margins[side] = newValue;
                
                // Êõ¥Êñ∞ËæìÂÖ•Ê°ÜÊòæÁ§∫
                document.getElementById(`margin${side.charAt(0).toUpperCase() + side.slice(1)}`).value = newValue;
                
                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËÅîÂä®Ë∞ÉÊï¥
                if ((side === 'left' || side === 'right') && this.marginLocks.horizontal) {
                    const otherSide = side === 'left' ? 'right' : 'left';
                    this.margins[otherSide] = newValue;
                    document.getElementById(`margin${otherSide.charAt(0).toUpperCase() + otherSide.slice(1)}`).value = newValue;
                }
                
                if ((side === 'top' || side === 'bottom') && this.marginLocks.vertical) {
                    const otherSide = side === 'top' ? 'bottom' : 'top';
                    this.margins[otherSide] = newValue;
                    document.getElementById(`margin${otherSide.charAt(0).toUpperCase() + otherSide.slice(1)}`).value = newValue;
                }
                
                // Êõ¥Êñ∞ÁîªÂ∏É‰∏äÁöÑ margin ÊòæÁ§∫
                this.updateCanvasMargins();
                
                // Êõ¥Êñ∞ column/row ÈÄâÈ°πÔºàÂõ†‰∏∫ margin ÂΩ±ÂìçÂèØÁî®Á©∫Èó¥Ôºâ
                // Column ÊòØÂûÇÁõ¥ÂàíÂàÜÔºåÂü∫‰∫é widthÔºåÂèó left/right margin ÂΩ±Âìç
                if (side === 'left' || side === 'right') {
                    this.updateColumnOptions();
                    // ÈáçÊñ∞ÁªòÂà∂ column Á∫ø
                    if (this.currentColumnNumber) {
                        this.drawColumns();
                    }
                }
                // Row ÊòØÊ∞¥Âπ≥ÂàíÂàÜÔºåÂü∫‰∫é heightÔºåÂèó top/bottom margin ÂΩ±Âìç
                if (side === 'top' || side === 'bottom') {
                    this.updateRowOptions();
                    // ÈáçÊñ∞ÁªòÂà∂ row Á∫ø
                    if (this.currentRowNumber) {
                        this.drawRows();
                    }
                }
                
                console.log(`Margin ${side} set to: ${newValue} pt`);
            }

            // Êõ¥Êñ∞ÁîªÂ∏É‰∏äÁöÑ margin ÊòæÁ§∫
            updateCanvasMargins() {
                // ‰ΩøÁî® pt Âçï‰ΩçÔºåËøôÊ†∑‰ºöÈöèÁîªÂ∏ÉÁº©Êîæ
                const leftEl = document.getElementById('marginLeftVis');
                const rightEl = document.getElementById('marginRightVis');
                const topEl = document.getElementById('marginTopVis');
                const bottomEl = document.getElementById('marginBottomVis');

                // Left margin - Á∫øÂú®Â∑¶‰æß
                if (this.margins.left > 0) {
                    leftEl.style.left = `${this.margins.left}pt`;
                    leftEl.style.opacity = '1';
                } else {
                    leftEl.style.opacity = '0';
                }

                // Right margin - Á∫øÂú®Âè≥‰æß
                if (this.margins.right > 0) {
                    rightEl.style.right = `${this.margins.right}pt`;
                    rightEl.style.opacity = '1';
                } else {
                    rightEl.style.opacity = '0';
                }

                // Top margin - Á∫øÂú®È°∂ÈÉ®
                if (this.margins.top > 0) {
                    topEl.style.top = `${this.margins.top}pt`;
                    topEl.style.opacity = '1';
                } else {
                    topEl.style.opacity = '0';
                }

                // Bottom margin - Á∫øÂú®Â∫ïÈÉ®
                if (this.margins.bottom > 0) {
                    bottomEl.style.bottom = `${this.margins.bottom}pt`;
                    bottomEl.style.opacity = '1';
                } else {
                    bottomEl.style.opacity = '0';
                }
            }

            // Column/Row Áõ∏ÂÖ≥ÊñπÊ≥ï

            // ÊâæÂà∞Êï∞ÁªÑ‰∏≠ÊúÄÊé•ËøëÁõÆÊ†áÂÄºÁöÑÂÖÉÁ¥†ÁöÑÁ¥¢Âºï
            findNearestIndex(array, target) {
                if (array.length === 0) return 0;
                
                let nearestIndex = 0;
                let minDiff = Math.abs(array[0] - target);
                
                for (let i = 1; i < array.length; i++) {
                    const diff = Math.abs(array[i] - target);
                    if (diff < minDiff) {
                        minDiff = diff;
                        nearestIndex = i;
                    }
                }
                
                return nearestIndex;
            }

            // ÈáçÁΩÆ column/row ËÆæÁΩÆ
            resetColumnRowSettings() {
                // ÈáçÁΩÆ spacing
                this.columnSpacing = null;
                this.rowSpacing = null;
                
                // ÈáçÁΩÆÈÄâÈ°πÂíåÂΩìÂâçÂÄº
                this.columnOptions = [];
                this.rowOptions = [];
                this.currentColumnNumber = null;
                this.currentRowNumber = null;
                
                // Ê∏ÖÁ©∫ÁîªÂ∏É‰∏äÁöÑÁ∫øÊù°
                const columnContainer = document.getElementById('canvasColumns');
                const rowContainer = document.getElementById('canvasRows');
                if (columnContainer) columnContainer.innerHTML = '';
                if (rowContainer) rowContainer.innerHTML = '';
                
                // ÈáçÁΩÆ UI ÊòæÁ§∫
                document.getElementById('columnSpacing').value = '-';
                document.getElementById('rowSpacing').value = '-';
                document.getElementById('columnDisplay').value = '-';
                document.getElementById('rowDisplay').value = '-';
                
                const columnSlider = document.getElementById('columnSlider');
                const rowSlider = document.getElementById('rowSlider');
                columnSlider.disabled = true;
                columnSlider.value = 0;
                rowSlider.disabled = true;
                rowSlider.value = 0;
                
                console.log('Column/Row settings reset');
            }

            // ÂàùÂßãÂåñ column spacing (ÈªòËÆ§‰∏∫ grid size)
            initializeColumnRowSpacing() {
                if (this.currentGridSize) {
                    // Âè™Âú®ËøòÊ≤°ÊúâËÆæÁΩÆÊó∂ÊâçÂàùÂßãÂåñ
                    if (this.columnSpacing === null || this.columnSpacing === undefined) {
                        this.columnSpacing = this.currentGridSize;
                    }
                    if (this.rowSpacing === null || this.rowSpacing === undefined) {
                        this.rowSpacing = this.currentGridSize;
                    }
                    this.updateColumnRowUI();
                }
            }

            // Â∞Ü column/row spacing Ë∞ÉÊï¥‰∏∫Êñ∞ grid size ÁöÑÂÄçÊï∞
            adjustColumnRowSpacingToGridSize() {
                if (!this.currentGridSize) return;
                
                // Ë∞ÉÊï¥ column spacing
                if (this.columnSpacing !== null && this.columnSpacing !== undefined) {
                    // Âêë‰∏ãÂèñÊï¥Âà∞ÊúÄËøëÁöÑ grid size ÂÄçÊï∞
                    const ratio = Math.floor(this.columnSpacing / this.currentGridSize);
                    this.columnSpacing = Math.max(0, ratio * this.currentGridSize);
                } else {
                    this.columnSpacing = this.currentGridSize;
                }
                
                // Ë∞ÉÊï¥ row spacing
                if (this.rowSpacing !== null && this.rowSpacing !== undefined) {
                    // Âêë‰∏ãÂèñÊï¥Âà∞ÊúÄËøëÁöÑ grid size ÂÄçÊï∞
                    const ratio = Math.floor(this.rowSpacing / this.currentGridSize);
                    this.rowSpacing = Math.max(0, ratio * this.currentGridSize);
                } else {
                    this.rowSpacing = this.currentGridSize;
                }
                
                // Êõ¥Êñ∞ UI ÂíåÈÄâÈ°πÔºàËøô‰ºöÈáçÊñ∞ËÆ°ÁÆóÂèØÁî®ÁöÑ column/row Êï∞ÈáèÂπ∂Ëá™Âä®ÈÄâÊã©ÊúÄÊé•ËøëÁöÑÂÄºÔºåÂπ∂ÈáçÊñ∞ÁªòÂà∂Á∫øÊù°Ôºâ
                this.updateColumnRowUI();
                
                console.log(`Column/Row spacing adjusted to grid size: column=${this.columnSpacing}pt, row=${this.rowSpacing}pt`);
            }

            // Ë∞ÉÊï¥ column spacing
            adjustColumnSpacing(direction) {
                if (!this.currentGridSize) return;
                
                const step = this.currentGridSize;
                const newValue = Math.max(0, this.columnSpacing + (direction * step));
                this.columnSpacing = newValue;
                
                document.getElementById('columnSpacing').value = newValue;
                
                // ÈáçÊñ∞ËÆ°ÁÆóÂèØÁî®ÁöÑ column Êï∞Èáè
                this.updateColumnOptions();
                
                // ÈáçÊñ∞ÁªòÂà∂ÔºàÂ¶ÇÊûúÂΩìÂâçÊúâÈÄâ‰∏≠ÁöÑ column numberÔºâ
                if (this.currentColumnNumber) {
                    this.drawColumns();
                }
                
                console.log(`Column spacing set to: ${newValue} pt`);
            }

            // Ë∞ÉÊï¥ row spacing
            adjustRowSpacing(direction) {
                if (!this.currentGridSize) return;
                
                const step = this.currentGridSize;
                const newValue = Math.max(0, this.rowSpacing + (direction * step));
                this.rowSpacing = newValue;
                
                document.getElementById('rowSpacing').value = newValue;
                
                // ÈáçÊñ∞ËÆ°ÁÆóÂèØÁî®ÁöÑ row Êï∞Èáè
                this.updateRowOptions();
                
                // ÈáçÊñ∞ÁªòÂà∂ÔºàÂ¶ÇÊûúÂΩìÂâçÊúâÈÄâ‰∏≠ÁöÑ row numberÔºâ
                if (this.currentRowNumber) {
                    this.drawRows();
                }
                
                console.log(`Row spacing set to: ${newValue} pt`);
            }

            // ËÆ°ÁÆóÂèØÁî®ÁöÑ column Êï∞ÈáèÔºàColumn ÊòØÂûÇÁõ¥ÂàíÂàÜÔºåÂü∫‰∫é widthÔºâ
            calculateColumnOptions() {
                if (!this.currentGridSize || this.columnSpacing === null || this.columnSpacing === undefined) {
                    return [];
                }

                const x = parseInt(document.getElementById('pageWidth').value);  // width
                const l = this.margins.left;
                const r = this.margins.right;
                const cs = this.columnSpacing;
                const gridSize = this.currentGridSize;

                const options = [];
                
                // ÂØπ‰∫é c = 1 Âà∞ 30ÔºåÊ£ÄÊü• (x - l - r - (c-1) * cs) ÊòØÂê¶ËÉΩË¢´ (grid_size * c) Êï¥Èô§
                for (let c = 1; c <= 30; c++) {
                    const available = x - l - r - (c - 1) * cs;
                    // ÂøÖÈ°ªÂ§ß‰∫é0Ôºå‰∏îËÉΩË¢´ (grid_size * c) Êï¥Èô§
                    if (available > 0 && available % (gridSize * c) === 0) {
                        options.push(c);
                    }
                }

                return options;
            }

            // ËÆ°ÁÆóÂèØÁî®ÁöÑ row Êï∞ÈáèÔºàRow ÊòØÊ∞¥Âπ≥ÂàíÂàÜÔºåÂü∫‰∫é heightÔºâ
            calculateRowOptions() {
                if (!this.currentGridSize || this.rowSpacing === null || this.rowSpacing === undefined) {
                    return [];
                }

                const y = parseInt(document.getElementById('pageHeight').value);  // height
                const t = this.margins.top;
                const b = this.margins.bottom;
                const rs = this.rowSpacing;
                const gridSize = this.currentGridSize;

                const options = [];
                
                // ÂØπ‰∫é rowNum = 1 Âà∞ 30ÔºåÊ£ÄÊü• (y - t - b - (rowNum-1) * rs) ÊòØÂê¶ËÉΩË¢´ (grid_size * rowNum) Êï¥Èô§
                for (let rowNum = 1; rowNum <= 30; rowNum++) {
                    const available = y - t - b - (rowNum - 1) * rs;
                    // ÂøÖÈ°ªÂ§ß‰∫é0Ôºå‰∏îËÉΩË¢´ (grid_size * rowNum) Êï¥Èô§
                    if (available > 0 && available % (gridSize * rowNum) === 0) {
                        options.push(rowNum);
                    }
                }

                return options;
            }

            // Êõ¥Êñ∞ column ÈÄâÈ°π
            updateColumnOptions() {
                this.columnOptions = this.calculateColumnOptions();
                
                console.log(`Column options: ${this.columnOptions.join(', ')}`);
                
                this.updateColumnUI();
            }

            // Êõ¥Êñ∞ row ÈÄâÈ°π
            updateRowOptions() {
                this.rowOptions = this.calculateRowOptions();
                
                console.log(`Row options: ${this.rowOptions.join(', ')}`);
                
                this.updateRowUI();
            }

            // Êõ¥Êñ∞ column UI
            updateColumnUI() {
                const slider = document.getElementById('columnSlider');
                const display = document.getElementById('columnDisplay');
                const previousColumnNumber = this.currentColumnNumber;
                
                if (this.columnOptions.length === 0) {
                    slider.disabled = true;
                    slider.min = 0;
                    slider.max = 0;
                    slider.value = 0;
                    display.value = '-';
                    this.currentColumnNumber = null;
                    this.drawColumns(); // Ê∏ÖÁ©∫Á∫øÊù°
                } else {
                    slider.disabled = false;
                    slider.min = 0;
                    slider.max = this.columnOptions.length - 1;
                    
                    // Â∞ùËØï‰øùÁïôÊàñÊâæÂà∞ÊúÄÊé•ËøëÁöÑÈÄâÈ°π
                    let selectedIndex = 0;
                    if (previousColumnNumber !== null && previousColumnNumber !== undefined) {
                        // Ê£ÄÊü•‰πãÂâçÁöÑÂÄºÊòØÂê¶ËøòÂú®ÈÄâÈ°π‰∏≠
                        const exactIndex = this.columnOptions.indexOf(previousColumnNumber);
                        if (exactIndex !== -1) {
                            // ‰πãÂâçÁöÑÂÄºËøòÂú®ÔºåÁõ¥Êé•‰ΩøÁî®
                            selectedIndex = exactIndex;
                        } else {
                            // ÊâæÂà∞ÊúÄÊé•ËøëÁöÑÂÄº
                            selectedIndex = this.findNearestIndex(this.columnOptions, previousColumnNumber);
                        }
                    }
                    
                    slider.value = selectedIndex;
                    this.currentColumnNumber = this.columnOptions[selectedIndex];
                    display.value = this.currentColumnNumber;
                    this.drawColumns(); // ÁªòÂà∂Á∫øÊù°
                }
            }

            // Êõ¥Êñ∞ row UI
            updateRowUI() {
                const slider = document.getElementById('rowSlider');
                const display = document.getElementById('rowDisplay');
                const previousRowNumber = this.currentRowNumber;
                
                if (this.rowOptions.length === 0) {
                    slider.disabled = true;
                    slider.min = 0;
                    slider.max = 0;
                    slider.value = 0;
                    display.value = '-';
                    this.currentRowNumber = null;
                    this.drawRows(); // Ê∏ÖÁ©∫Á∫øÊù°
                } else {
                    slider.disabled = false;
                    slider.min = 0;
                    slider.max = this.rowOptions.length - 1;
                    
                    // Â∞ùËØï‰øùÁïôÊàñÊâæÂà∞ÊúÄÊé•ËøëÁöÑÈÄâÈ°π
                    let selectedIndex = 0;
                    if (previousRowNumber !== null && previousRowNumber !== undefined) {
                        // Ê£ÄÊü•‰πãÂâçÁöÑÂÄºÊòØÂê¶ËøòÂú®ÈÄâÈ°π‰∏≠
                        const exactIndex = this.rowOptions.indexOf(previousRowNumber);
                        if (exactIndex !== -1) {
                            // ‰πãÂâçÁöÑÂÄºËøòÂú®ÔºåÁõ¥Êé•‰ΩøÁî®
                            selectedIndex = exactIndex;
                        } else {
                            // ÊâæÂà∞ÊúÄÊé•ËøëÁöÑÂÄº
                            selectedIndex = this.findNearestIndex(this.rowOptions, previousRowNumber);
                        }
                    }
                    
                    slider.value = selectedIndex;
                    this.currentRowNumber = this.rowOptions[selectedIndex];
                    display.value = this.currentRowNumber;
                    this.drawRows(); // ÁªòÂà∂Á∫øÊù°
                }
            }

            // Êõ¥Êñ∞ column/row UIÔºàspacing ÊòæÁ§∫Ôºâ
            updateColumnRowUI() {
                const columnSpacingInput = document.getElementById('columnSpacing');
                const rowSpacingInput = document.getElementById('rowSpacing');
                const columnSpacingDownBtn = document.getElementById('columnSpacingDown');
                const columnSpacingUpBtn = document.getElementById('columnSpacingUp');
                const rowSpacingDownBtn = document.getElementById('rowSpacingDown');
                const rowSpacingUpBtn = document.getElementById('rowSpacingUp');
                
                if (this.currentGridSize) {
                    // ‰ΩøÁî® !== null Âíå !== undefined Êù•ÂÖÅËÆ∏ spacing ‰∏∫ 0
                    columnSpacingInput.value = (this.columnSpacing !== null && this.columnSpacing !== undefined) 
                        ? this.columnSpacing 
                        : this.currentGridSize;
                    rowSpacingInput.value = (this.rowSpacing !== null && this.rowSpacing !== undefined) 
                        ? this.rowSpacing 
                        : this.currentGridSize;
                    columnSpacingDownBtn.disabled = false;
                    columnSpacingUpBtn.disabled = false;
                    rowSpacingDownBtn.disabled = false;
                    rowSpacingUpBtn.disabled = false;
                    
                    // Êõ¥Êñ∞ column Âíå row ÈÄâÈ°π
                    this.updateColumnOptions();
                    this.updateRowOptions();
                } else {
                    columnSpacingInput.value = '-';
                    rowSpacingInput.value = '-';
                    columnSpacingDownBtn.disabled = true;
                    columnSpacingUpBtn.disabled = true;
                    rowSpacingDownBtn.disabled = true;
                    rowSpacingUpBtn.disabled = true;
                }
            }

            // ÁªòÂà∂ Column Á∫øÔºàÁ∫µÂêëÔºåÂûÇÁõ¥Á∫øÔºâ- Column ÊòØÂûÇÁõ¥ÂàíÂàÜÔºåÂü∫‰∫é width
            drawColumns() {
                const container = document.getElementById('canvasColumns');
                container.innerHTML = ''; // Ê∏ÖÁ©∫‰πãÂâçÁöÑÁ∫ø
                
                if (!this.currentColumnNumber || this.currentColumnNumber < 1) {
                    return;
                }

                const x = parseInt(document.getElementById('pageWidth').value);
                const l = this.margins.left;
                const r = this.margins.right;
                const cs = this.columnSpacing;
                const c = this.currentColumnNumber;
                
                // ËÆ°ÁÆóÊÄªÁöÑÂèØÁî®ÂÆΩÂ∫¶ÔºàÈô§ÂéªÂ∑¶Âè≥ marginÔºâ
                const availableWidth = x - l - r;
                
                // ËÆ°ÁÆóÊÄªÁöÑ spacing ÂÆΩÂ∫¶
                const totalSpacing = (c - 1) * cs;
                
                // ËÆ°ÁÆóÊØè‰∏™ column ÁöÑÂÆΩÂ∫¶ÔºàÂâ©‰ΩôÁ©∫Èó¥Âπ≥ÂùáÂàÜÈÖçÔºâ
                const columnWidth = (availableWidth - totalSpacing) / c;
                
                let currentLeft = l;
                
                // ÁªòÂà∂ÊØè‰∏™ column Âíå spacingÔºàË∑≥ËøáÁ¨¨‰∏ÄÊù°ÂíåÊúÄÂêé‰∏ÄÊù°Á∫øÔºåÈÅøÂÖç‰∏é margin ÈáçÂè†Ôºâ
                for (let i = 0; i < c; i++) {
                    // Ë∑≥ËøáÁ¨¨‰∏ÄÊù°Á∫øÔºài=0 Êó∂Ôºå‰∏é left margin ÈáçÂè†Ôºâ
                    // ÁªòÂà∂ column Â∑¶‰æßÁ∫ø
                    if (i > 0) {
                        const leftLine = document.createElement('div');
                        leftLine.className = 'column-line';
                        leftLine.style.left = `${currentLeft}pt`;
                        leftLine.style.top = '0';
                        leftLine.style.bottom = '0';
                        leftLine.style.width = '2px';
                        leftLine.style.height = 'auto';
                        leftLine.style.background = '#00ffff';
                        container.appendChild(leftLine);
                    }
                    
                    currentLeft += columnWidth;
                    
                    // Â¶ÇÊûú‰∏çÊòØÊúÄÂêé‰∏Ä‰∏™ columnÔºåÁªòÂà∂ spacing ÁöÑÂ∑¶Âè≥ËæπÁïåÁ∫ø
                    if (i < c - 1) {
                        // Spacing Â∑¶‰æßÁ∫øÔºà‰πüÊòØ column Âè≥‰æßÁ∫øÔºâ
                        const spacingLeftLine = document.createElement('div');
                        spacingLeftLine.className = 'column-line';
                        spacingLeftLine.style.left = `${currentLeft}pt`;
                        spacingLeftLine.style.top = '0';
                        spacingLeftLine.style.bottom = '0';
                        spacingLeftLine.style.width = '2px';
                        spacingLeftLine.style.height = 'auto';
                        spacingLeftLine.style.background = '#00ffff';
                        container.appendChild(spacingLeftLine);
                        
                        currentLeft += cs;
                    }
                }
                
                // Ë∑≥ËøáÊúÄÂêé‰∏ÄÊù°Á∫øÔºà‰∏é right margin ÈáçÂè†Ôºâ
                // ‰∏çÂÜçÁªòÂà∂ rightLine
            }

            // ÁªòÂà∂ Row Á∫øÔºàÊ®™ÂêëÔºåÊ∞¥Âπ≥Á∫øÔºâ- Row ÊòØÊ∞¥Âπ≥ÂàíÂàÜÔºåÂü∫‰∫é height
            drawRows() {
                const container = document.getElementById('canvasRows');
                container.innerHTML = ''; // Ê∏ÖÁ©∫‰πãÂâçÁöÑÁ∫ø
                
                if (!this.currentRowNumber || this.currentRowNumber < 1) {
                    return;
                }

                const y = parseInt(document.getElementById('pageHeight').value);
                const t = this.margins.top;
                const b = this.margins.bottom;
                const rs = this.rowSpacing;
                const rowNum = this.currentRowNumber;
                
                // ËÆ°ÁÆóÊÄªÁöÑÂèØÁî®È´òÂ∫¶ÔºàÈô§Âéª‰∏ä‰∏ã marginÔºâ
                const availableHeight = y - t - b;
                
                // ËÆ°ÁÆóÊÄªÁöÑ spacing È´òÂ∫¶
                const totalSpacing = (rowNum - 1) * rs;
                
                // ËÆ°ÁÆóÊØè‰∏™ row ÁöÑÈ´òÂ∫¶ÔºàÂâ©‰ΩôÁ©∫Èó¥Âπ≥ÂùáÂàÜÈÖçÔºâ
                const rowHeight = (availableHeight - totalSpacing) / rowNum;
                
                let currentTop = t;
                
                // ÁªòÂà∂ÊØè‰∏™ row Âíå spacingÔºàË∑≥ËøáÁ¨¨‰∏ÄÊù°ÂíåÊúÄÂêé‰∏ÄÊù°Á∫øÔºåÈÅøÂÖç‰∏é margin ÈáçÂè†Ôºâ
                for (let i = 0; i < rowNum; i++) {
                    // Ë∑≥ËøáÁ¨¨‰∏ÄÊù°Á∫øÔºài=0 Êó∂Ôºå‰∏é top margin ÈáçÂè†Ôºâ
                    // ÁªòÂà∂ row È°∂ÈÉ®Á∫ø
                    if (i > 0) {
                        const topLine = document.createElement('div');
                        topLine.className = 'row-line';
                        topLine.style.top = `${currentTop}pt`;
                        topLine.style.left = '0';
                        topLine.style.right = '0';
                        topLine.style.height = '2px';
                        topLine.style.width = 'auto';
                        topLine.style.background = '#00ffff';
                        container.appendChild(topLine);
                    }
                    
                    currentTop += rowHeight;
                    
                    // Â¶ÇÊûú‰∏çÊòØÊúÄÂêé‰∏Ä‰∏™ rowÔºåÁªòÂà∂ spacing ÁöÑ‰∏ä‰∏ãËæπÁïåÁ∫ø
                    if (i < rowNum - 1) {
                        // Spacing È°∂ÈÉ®Á∫øÔºà‰πüÊòØ row Â∫ïÈÉ®Á∫øÔºâ
                        const spacingTopLine = document.createElement('div');
                        spacingTopLine.className = 'row-line';
                        spacingTopLine.style.top = `${currentTop}pt`;
                        spacingTopLine.style.left = '0';
                        spacingTopLine.style.right = '0';
                        spacingTopLine.style.height = '2px';
                        spacingTopLine.style.width = 'auto';
                        spacingTopLine.style.background = '#00ffff';
                        container.appendChild(spacingTopLine);
                        
                        currentTop += rs;
                    }
                }
                
                // Ë∑≥ËøáÊúÄÂêé‰∏ÄÊù°Á∫øÔºà‰∏é bottom margin ÈáçÂè†Ôºâ
                // ‰∏çÂÜçÁªòÂà∂ bottomLine
            }

            restrictToNumbers(e, allowDecimal = false) {
                // ÂÖÅËÆ∏ÁöÑÊåâÈîÆÔºöÊï∞Â≠ó„ÄÅÈÄÄÊ†º„ÄÅÂà†Èô§„ÄÅÊñπÂêëÈîÆ„ÄÅTab„ÄÅEnter
                const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End'];
                
                // ÂÖÅËÆ∏ Ctrl/Cmd + A, C, V, X (ÂÖ®ÈÄâ„ÄÅÂ§çÂà∂„ÄÅÁ≤òË¥¥„ÄÅÂâ™Âàá)
                if ((e.ctrlKey || e.metaKey) && ['a', 'c', 'v', 'x'].includes(e.key.toLowerCase())) {
                    return;
                }
                
                // Â¶ÇÊûúÊòØÂÖÅËÆ∏ÁöÑÊåâÈîÆÔºåÁõ¥Êé•ÈÄöËøá
                if (allowedKeys.includes(e.key)) {
                    return;
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÊï∞Â≠ó
                if (e.key >= '0' && e.key <= '9') {
                    return;
                }
                
                // Â¶ÇÊûúÂÖÅËÆ∏Â∞èÊï∞ÁÇπÔºåÊ£ÄÊü•Â∞èÊï∞ÁÇπ
                if (allowDecimal && e.key === '.') {
                    // Á°Æ‰øùÂè™Êúâ‰∏Ä‰∏™Â∞èÊï∞ÁÇπ
                    if (!e.target.value.includes('.')) {
                        return;
                    }
                }
                
                // ÈòªÊ≠¢ÂÖ∂‰ªñÊâÄÊúâÊåâÈîÆ
                e.preventDefault();
            }

            handleNumberPaste(e) {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                // ÁßªÈô§ÊâÄÊúâÈùûÊï∞Â≠óÂ≠óÁ¨¶Ôºà‰øùÁïôÊï∞Â≠óÂíåÂ∞èÊï∞ÁÇπÔºâ
                const cleanedText = pastedText.replace(/[^0-9.]/g, '');
                // Á°Æ‰øùÂè™Êúâ‰∏Ä‰∏™Â∞èÊï∞ÁÇπ
                const parts = cleanedText.split('.');
                const finalText = parts.length > 1 ? parts[0] + '.' + parts.slice(1).join('') : cleanedText;
                
                if (finalText) {
                    // ÊèíÂÖ•Ê∏ÖÁêÜÂêéÁöÑÊñáÊú¨
                    const input = e.target;
                    const start = input.selectionStart;
                    const end = input.selectionEnd;
                    const currentValue = input.value;
                    input.value = currentValue.substring(0, start) + finalText + currentValue.substring(end);
                    // ËÆæÁΩÆÂÖâÊ†á‰ΩçÁΩÆ
                    const newPosition = start + finalText.length;
                    input.setSelectionRange(newPosition, newPosition);
                    // Ëß¶Âèë input ‰∫ã‰ª∂‰ª•Êõ¥Êñ∞ÁîªÂ∏É
                    input.dispatchEvent(new Event('input'));
                }
            }

            updateCanvasSize() {
                const widthPt = parseFloat(document.getElementById('pageWidth').value);
                const heightPt = parseFloat(document.getElementById('pageHeight').value);
                
                if (widthPt && heightPt) {
                    // ‰ΩøÁî®ptÂçï‰ΩçËÆæÁΩÆCSSÊ†∑Âºè
                    this.canvas.style.width = widthPt + 'pt';
                    this.canvas.style.height = heightPt + 'pt';
                    
                    // Ëá™Âä®ÈÄÇÈÖçÁº©ÊîæÔºà‰º†ÂÖ•ptÂÄºÔºåÂáΩÊï∞ÂÜÖÈÉ®‰ºöËΩ¨Êç¢ÔºåÂêØÁî®Âä®ÁîªÔºâ
                    this.fitCanvasToView(widthPt, heightPt, true);
                    
                    console.log(`ÁîªÂ∏ÉÂ§ßÂ∞èÂ∑≤Êõ¥Êñ∞: ${widthPt}pt √ó ${heightPt}pt`);
                }
            }

            fitCanvasToView(canvasWidthPt, canvasHeightPt, animate = false) {
                // Â∞ÜptËΩ¨Êç¢‰∏∫pxÁî®‰∫éËÆ°ÁÆó
                const canvasWidthPx = this.ptToPx(canvasWidthPt);
                const canvasHeightPx = this.ptToPx(canvasHeightPt);
                
                // Ëé∑ÂèñÁîªÂ∏ÉÊòæÁ§∫Âå∫ÂüüÁöÑÂ∞∫ÂØ∏ÔºàpxÔºâ
                const canvasArea = this.canvasContainer.parentElement;
                const areaWidth = canvasArea.clientWidth;
                const areaHeight = canvasArea.clientHeight;
                
                // ÁïôÂá∫ËæπË∑ù (margin, in px)
                const margin = 25;
                const availableWidth = areaWidth - margin * 2;
                const availableHeight = areaHeight - margin * 2;
                
                // ËÆ°ÁÆóÁº©ÊîæÊØî‰æãÔºåËÆ©ÈïøËæπÈÄÇÈÖçÂà∞ÊòæÁ§∫Âå∫Âüü
                const scaleX = availableWidth / canvasWidthPx;
                const scaleY = availableHeight / canvasHeightPx;
                this.scale = Math.min(scaleX, scaleY);  // ÂèñËæÉÂ∞èÁöÑÊØî‰æãÁ°Æ‰øùÁîªÂ∏ÉÂÆåÂÖ®ÂèØËßÅ
                
                // ÈôêÂà∂ÊúÄÂ§ßÁº©ÊîæÊØî‰æãÔºåÈÅøÂÖçËøáÂ∫¶ÊîæÂ§ß
                this.scale = Math.min(this.scale, 3);
                // ÈôêÂà∂ÊúÄÂ∞èÁº©ÊîæÊØî‰æã
                this.scale = Math.max(this.scale, 0.05);
                
                // ÈáçÁΩÆÂÅèÁßªÔºåËÆ©ÁîªÂ∏ÉÂ±Ö‰∏≠
                this.offsetX = 0;
                this.offsetY = 0;
                
                // Êõ¥Êñ∞ transform Âíå zoom display
                this.updateCanvasTransform(animate);
                this.updateZoomDisplay();
                
                console.log(`Ëá™Âä®ÈÄÇÈÖç: ÁîªÂ∏É ${canvasWidthPt}pt √ó ${canvasHeightPt}pt, Áº©ÊîæÊØî‰æã = ${(this.scale * 100).toFixed(1)}%`);
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            new GriDesigner();
        });
    </script>
</body>
</html>